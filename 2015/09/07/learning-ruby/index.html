<!doctype html>
<html class="theme-next use-motion ">
<head>
    

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/blog/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/blog/css/main.css?v=0.4.4"/>




  <meta name="keywords" content="ruby," />



  <link rel="alternate" href="/blog/atom.xml" title="Jin Liu" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.4" />


<meta name="description" content="æˆ‘çš„åˆæ‹ğŸ’—

å¸¸ç”¨å‘½ä»¤
rails generate scaffold User name:string email:string
bundle exec rake db:migrateä¹‹æ‰€ä»¥ä½¿ç”¨bundle exec rakeï¼Œè€Œä¸æ˜¯ä½¿ç”¨rakeï¼Œæ˜¯å¸Œæœ›ä½¿ç”¨åœ¨GemfileæŒ‡å®šçš„rakeç‰ˆæœ¬
rails new sample_app --skip-test-unit
rails server">
<meta property="og:type" content="article">
<meta property="og:title" content="Ruby å­¦ä¹ è®°å½• (æ›´æ–°ä¸­)">
<meta property="og:url" content="http://liujin.me/blog/2015/09/07/learning-ruby/index.html">
<meta property="og:site_name" content="Jin Liu">
<meta property="og:description" content="æˆ‘çš„åˆæ‹ğŸ’—

å¸¸ç”¨å‘½ä»¤
rails generate scaffold User name:string email:string
bundle exec rake db:migrateä¹‹æ‰€ä»¥ä½¿ç”¨bundle exec rakeï¼Œè€Œä¸æ˜¯ä½¿ç”¨rakeï¼Œæ˜¯å¸Œæœ›ä½¿ç”¨åœ¨GemfileæŒ‡å®šçš„rakeç‰ˆæœ¬
rails new sample_app --skip-test-unit
rails server">
<meta property="og:updated_time" content="2015-09-08T01:44:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ruby å­¦ä¹ è®°å½• (æ›´æ–°ä¸­)">
<meta name="twitter:description" content="æˆ‘çš„åˆæ‹ğŸ’—

å¸¸ç”¨å‘½ä»¤
rails generate scaffold User name:string email:string
bundle exec rake db:migrateä¹‹æ‰€ä»¥ä½¿ç”¨bundle exec rakeï¼Œè€Œä¸æ˜¯ä½¿ç”¨rakeï¼Œæ˜¯å¸Œæœ›ä½¿ç”¨åœ¨GemfileæŒ‡å®šçš„rakeç‰ˆæœ¬
rails new sample_app --skip-test-unit
rails server">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>

    <title> Ruby å­¦ä¹ è®°å½• (æ›´æ–°ä¸­) // Jin Liu </title>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="">
<!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-63369689-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?83ff44680c7cadeb2554faf4fe320eb8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



<div class="container one-column page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/blog/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Jin Liu</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-home"></i> <br />
            é¦–é 
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories" rel="section">
            <i class="menu-item-icon icon-categories"></i> <br />
            åˆ†é¡
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives" rel="section">
            <i class="menu-item-icon icon-archives"></i> <br />
            æ­¸æª”
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags" rel="section">
            <i class="menu-item-icon icon-tags"></i> <br />
            æ¨™ç±¤
          </a>
        </li>
      
        
        <li class="menu-item menu-item-old">
          <a href="http://liujin.logdown.com/" rel="section">
            <i class="menu-item-icon icon-old"></i> <br />
            èˆŠæ–‡
          </a>
        </li>
      
        
        <li class="menu-item menu-item-projects">
          <a href="/blog/projects" rel="section">
            <i class="menu-item-icon icon-projects"></i> <br />
            é …ç›®
          </a>
        </li>
      
    </ul>
  

  
</nav>


        </div>
    </header>

    <main id="main" class="main">
        <div class="main-inner">
            <div id="content" class="content">
                

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              Ruby å­¦ä¹ è®°å½• (æ›´æ–°ä¸­)
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          ç™¼è¡¨æ–¼
          <time itemprop="dateCreated" datetime="2015-09-07T10:53:17+08:00" content="2015-09-07">
            2015-09-07
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; åˆ†é¡æ–¼
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/blog/categories/å­¦ä¹ è®°å½•/" itemprop="url" rel="index"><span itemprop="name">å­¦ä¹ è®°å½•</span></a></span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/blog/2015/09/07/learning-ruby/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/07/learning-ruby/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><blockquote class="blockquote-center">æˆ‘çš„åˆæ‹ğŸ’—</blockquote>

<h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2><ol>
<li><code>rails generate scaffold User name:string email:string</code></li>
<li><code>bundle exec rake db:migrate</code><br>ä¹‹æ‰€ä»¥ä½¿ç”¨<code>bundle exec rake</code>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨<code>rake</code>ï¼Œæ˜¯å¸Œæœ›ä½¿ç”¨åœ¨GemfileæŒ‡å®šçš„rakeç‰ˆæœ¬</li>
<li><code>rails new sample_app --skip-test-unit</code></li>
<li><code>rails server -p 7777</code> railså¯åŠ¨ä½¿ç”¨å…¶ä»–ç«¯å£</li>
<li><code>rails console â€”sandbox</code> ä¿è¯é€€å‡ºconsoleçš„æ—¶å€™æ•°æ®ä¼šæ¸…ç©º</li>
<li><code>rails g model Post title:text content:text -p</code><br><code>-p</code> è¡¨ç¤º <code>pretend</code>ä¼šåˆ—å‡ºæ¥è¿™ä¸ªå‘½ä»¤ä¼šæ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œä¼šç”Ÿæˆä»€ä¹ˆæ–‡ä»¶ï¼Œä½†ä¸ä¼šå»çœŸæ­£æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚<a id="more"></a>
</li>
</ol>
<hr>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2><ol>
<li><a href="http://stackoverflow.com/questions/10048173/why-is-it-bad-style-to-rescue-exception-e-in-ruby" target="_blank" rel="external">Why is it bad style to <code>rescue Exception =&gt; e</code> in Ruby?</a></li>
</ol>
<hr>
<h2 id="æ–‡ç« ">æ–‡ç« </h2><ol>
<li><a href="https://blog.newrelic.com/2014/11/13/weird-ruby-begin-end/" target="_blank" rel="external">Weird Ruby Part 1: The Beginning of the End</a></li>
</ol>
<hr>
<h2 id="Rails">Rails</h2><h3 id="1-_å†™routeçš„æ—¶å€™ï¼Œactionå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œviewæ‰æ˜¯å¿…é¡»çš„">1. å†™routeçš„æ—¶å€™ï¼Œactionå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œviewæ‰æ˜¯å¿…é¡»çš„</h3><p>å¦‚é¡¹ç›®ä¸­çš„chooseé¡µé¢ï¼Œroutesé‡Œé¢æŒ‡å®šäº†ï¼Œ</p>
<pre><code><span class="keyword">match</span> <span class="string">"/choose"</span> =&gt; <span class="string">"decks#choose"</span>, :<span class="keyword">as</span> =&gt; :choose
</code></pre><p>å› ä¸ºä¸éœ€è¦ä¼ è¿‡å»viewsä»»ä½•å˜é‡ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨ decks_controller é‡Œé¢å®šä¹‰ choose æ–¹æ³•ï¼Œåªè¦viewsæ–‡ä»¶å¤¹é‡Œé¢æœ‰choose.html.haml æ–‡ä»¶å³å¯ã€‚<br><a href="http://stackoverflow.com/questions/4477061/rails-3-0-adding-new-action-to-a-controller" target="_blank" rel="external">å‚è€ƒæ–‡ç« ï¼š</a></p>
<p>Add this to routes.rb:</p>
<pre><code><span class="keyword">get</span> <span class="string">'mycontroller/foobar'</span>
</code></pre><p>This will route the URL <a href="http://mysite.com/foobar" target="_blank" rel="external">http://mysite.com/foobar</a> to the foobar action using HTTP GET.</p>
<p>Some more info:</p>
<ul>
<li>Note that defining a def foobar in the controller is not a strict requirement (unless you need to do something in foobar before the view is displayed) - but the view must exist. In other words, even if def foobar method does not exist in the controller, the view foobar.html.erb will still be rendered.</li>
<li>Here is a good overview of routes in Rails 3.</li>
<li>Also, in case you donâ€™t already know, you can list all the routes that you app knows about usingrake routes. Consequently, if the output of rake routes does not list the route to some controller/action, then the â€˜No route matchesâ€™ error will occur.</li>
</ul>
<h3 id="2-_Array/Hash_éƒ½ç»§æ‰¿äº†_Enumerable_çš„æ–¹æ³•ï¼Œä½†map,collect,map!,collect!_åªæœ‰Arrayæ‰æ”¯æŒ">2. Array/Hash éƒ½ç»§æ‰¿äº† Enumerable çš„æ–¹æ³•ï¼Œä½†<code>map</code>,<code>collect</code>,<code>map!</code>,<code>collect!</code> åªæœ‰Arrayæ‰æ”¯æŒ</h3><p>Hashæƒ³å®ç°åˆ™éœ€è¦ <code>inject</code> æˆ–è€… <code>each_with_object</code>, ç ´åæ€§æ–¹æ³•å¯ä»¥ç”¨ <code>each</code></p>
<pre><code>my_hash = { a: <span class="string">'foo'</span>, b: <span class="string">'bar'</span> }
# =&gt; {:a=&gt;<span class="string">"foo"</span>, :b=&gt;<span class="string">"bar"</span>}
a_new_hash = my_hash.inject({}) {|h, (k, v)| h[k.upcase] = v.upcase; h }
# =&gt; {:A=&gt;<span class="string">"FOO"</span>, :B=&gt;<span class="string">"BAR"</span>}
# OR
a_new_hash = my_hash.each_with_object({}) {|(k,v), h| h[k.upcase] = v.upcase }
# =&gt; {:A=&gt;<span class="string">"FOO"</span>, :B=&gt;<span class="string">"BAR"</span>}
# OR
a_new_hash = Hash[my_hash.map { |k, v| [k.upcase, v.upcase] }]
# =&gt; {:A=&gt;<span class="string">"FOO"</span>, :B=&gt;<span class="string">"BAR"</span>}
# ORç ´åæ€§,ä¸è¿‡ä¸èƒ½ä¿®æ”¹key
my_hash.each {|k,v| my_hash[k] = v.upcase }
# =&gt; {:a=&gt;<span class="string">"FOO"</span>, :b=&gt;<span class="string">"BAR"</span>}
</code></pre><h3 id="3-_Hash_to_URL_query">3. Hash to URL query</h3><p><code>to_query</code>:</p>
<pre><code><span class="string">"http://www.example.com?"</span> + { language: <span class="string">"ruby"</span>, status: <span class="string">"awesome"</span> }.to_query
<span class="preprocessor"># =&gt; <span class="string">"http://www.example.com?language=ruby&amp;status=awesome"</span></span>
</code></pre><p><code>CGI.parse</code>:</p>
<pre><code>require <span class="string">'cgi'</span> # Only needed <span class="keyword">for</span> IRB, Rails already has <span class="keyword">this</span> loaded
CGI::parse <span class="string">"language=ruby&amp;status=awesome"</span>
# =&gt; {<span class="string">"language"</span>=&gt;[<span class="string">"ruby"</span>], <span class="string">"status"</span>=&gt;[<span class="string">"awesome"</span>]}
Both methods support nested values.
</code></pre><h3 id="4-_rails_console_tips">4. rails console tips</h3><p>  <code>_</code> è¿”å›å‰ä¸€ä¸ªè¾“å‡ºï¼Œå¦‚ï¼š<code>a = [1,2,3] # =&gt; [1,2,3] _ # =&gt; [1,2,3]</code></p>
<h3 id="5-_érailsé¡¹ç›®ä½¿ç”¨_ActiveSupport">5. érailsé¡¹ç›®ä½¿ç”¨ ActiveSupport</h3><p>  <code>require &quot;active_support/all&quot;</code></p>
<p>Since using Rails should handle this automatically Iâ€™m going to assume youâ€™re trying to add ActiveSupport to a non-Rails script.</p>
<p>ActiveSupportâ€™s methods got broken into smaller groups in Rails 3, so we donâ€™t end up loading a lot of unneeded stuff with a simple <code>require &#39;activesupport&#39;</code>. Now we have to do things like require <code>&#39;active_support/core_ext/object/blank&#39;</code></p>
<p>If you donâ€™t care about granularity, you can choose to load bigger chunks. If you want everything in one big gulp useâ€¦</p>
<p>For 1.9.2:</p>
<pre><code>rvm <span class="number">1.9</span>.<span class="number">2</span>
irb -f
<span class="function"><span class="title">irb</span><span class="params">(main)</span></span>:<span class="number">001</span>:<span class="number">0</span>]]
&gt;
require <span class="string">'active_support/all'</span>
=&gt;true
<span class="function"><span class="title">irb</span><span class="params">(main)</span></span>:<span class="number">002</span>:<span class="number">0</span>]]
&gt;
<span class="number">1</span><span class="class">.week</span><span class="class">.ago</span>
=&gt;<span class="number">2010</span>-<span class="number">11</span>-<span class="number">1417</span>:<span class="number">56</span>:<span class="number">16</span>-<span class="number">0700</span>
</code></pre><p>For 1.8.7:</p>
<pre><code>rvm <span class="number">1.8</span>.<span class="number">7</span>
irb -f
<span class="function"><span class="title">irb</span><span class="params">(main)</span></span>:<span class="number">001</span>:<span class="number">0</span>]]
&gt;
require <span class="string">'rubygems'</span>
=&gt;true
<span class="function"><span class="title">irb</span><span class="params">(main)</span></span>:<span class="number">002</span>:<span class="number">0</span>]]
&gt;
require <span class="string">'active_support/all'</span>
=&gt;true
<span class="function"><span class="title">irb</span><span class="params">(main)</span></span>:<span class="number">003</span>:<span class="number">0</span>]]
&gt;
<span class="number">1</span><span class="class">.week</span><span class="class">.ago</span>
=&gt;SunNov1417:<span class="number">54</span>:<span class="number">19</span>-<span class="number">07002010</span>
</code></pre><h3 id="6-_Rspec">6. Rspec</h3><ol>
<li>å‡†å¤‡æ•°æ® <code>bundle exec rake db:test:prepare</code></li>
<li>è·‘èµ·æ¥ <code>rspec</code> / <code>rspec spec/models/upyun_file_spec.rb</code></li>
</ol>
<h3 id="7-_Unicorn">7. Unicorn</h3><p>åœ¨<code>development</code>å¾—æ—¶å€™ï¼Œunicorné»˜è®¤çš„logæ˜¯åƒnginxä¸€æ ·çš„ï¼Œæ²¡æœ‰å¤šå¤§å¾—debugä»·å€¼ï¼Œè¦æƒ³webrické‚£æ ·çš„logåªå¥½è‡ªå·±åŠ¨ä¸‹æ‰‹äº†ã€‚<br><a href="http://dave.is/unicorn.html" target="_blank" rel="external">å‚è€ƒé“¾æ¥</a>ï¼š</p>
<p>ä½¿ç”¨<code>rails server</code>ä¸€æ ·çš„logger:</p>
<pre><code><span class="comment"># config/environments/development.rb</span>
<span class="constant">Hackerschool:</span><span class="symbol">:Application</span>.configure <span class="keyword">do</span>
  <span class="comment"># ...</span>
  config.logger = <span class="constant">Logger.</span>new(<span class="constant">STDOUT)</span>
  config.logger.level = <span class="constant">Logger.</span>const_get(
    <span class="constant">ENV[</span><span class="string">'LOG_LEVEL'</span>] ? <span class="constant">ENV[</span><span class="string">'LOG_LEVEL'</span>].upcase <span class="symbol">:</span> <span class="string">'DEBUG'</span>
  )
<span class="keyword">end</span>
</code></pre><p>å»æ‰unicorné»˜è®¤çš„ç±»nginxçš„loggerï¼š</p>
<pre><code>$ RACK_ENV=none RAILS_ENV=development unicorn -c config/unicorn.rb
# <span class="keyword">If</span> youâ€™re <span class="keyword">using</span> foreman <span class="keyword">to</span> run your app locally, you can put these <span class="keyword">into</span> your .env file.
</code></pre><hr>
<h2 id="ä»£ç ç‰‡æ®µ">ä»£ç ç‰‡æ®µ</h2><h3 id="1-_æ‰¾å‡ºnoteså­—æ®µé•¿åº¦å°äº8çš„è®°å½•">1. æ‰¾å‡ºnoteså­—æ®µé•¿åº¦å°äº8çš„è®°å½•</h3><p><code>Photographer.where(&quot;CHARACTER_LENGTH(notes) &lt; 8&quot;)</code></p>
<h3 id="2-_æ£€æŸ¥æ•°ç»„æ˜¯ä¸æ˜¯å…¨éƒ¨éç©ºç™½">2. æ£€æŸ¥æ•°ç»„æ˜¯ä¸æ˜¯å…¨éƒ¨éç©ºç™½</h3><p><code>[&quot;&quot;, nil].all?(&amp;:blank?)</code></p>
<h3 id="3-_åœ¨consoleåˆ é™¤è®°å½•">3. åœ¨consoleåˆ é™¤è®°å½•</h3><p><code>User.find(2).destroy</code></p>
<h3 id="4-_use_begin-end_for_cached_value">4. use <code>begin..end</code> for cached value</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cached_value</span></span></span><br><span class="line">  <span class="variable">@cache</span> ||= <span class="keyword">begin</span></span><br><span class="line">    <span class="comment"># a multi-line calculation</span></span><br><span class="line">    <span class="comment"># of cache here, ending with</span></span><br><span class="line">    <span class="comment"># the value</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Ruby">Ruby</h2><h3 id="Hash">Hash</h3><h4 id="{}çœç•¥çš„æƒ…å†µ">{}çœç•¥çš„æƒ…å†µ</h4><p>å¦‚æœæ–¹æ³•æœ€åä¸€ä¸ªå‚æ•°æ˜¯hashï¼Œ<code>{}</code>å¯ä»¥çœç•¥æ‰ï¼Œå¦‚ï¼š</p>
<pre><code>link_to(body, url, html_options = {})
link_to <span class="string">"Click me"</span>, object_path, <span class="symbol">:class=&gt;<span class="string">"my_css_class"</span></span>, <span class="symbol">:id=&gt;<span class="string">"my_css_id"</span></span>
link_to <span class="string">"Click me"</span>, object_path, { <span class="symbol">:class=&gt;<span class="string">"my_css_class"</span></span>, <span class="symbol">:id=&gt;<span class="string">"my_css_id"</span></span> }
</code></pre><h4 id="rocket_style_æ˜¯ä¸æ˜¯å·²ç»åºŸå¼ƒæ‰äº†ï¼Ÿ">rocket style æ˜¯ä¸æ˜¯å·²ç»åºŸå¼ƒæ‰äº†ï¼Ÿ</h4><p>Ref: <a href="http://logicalfriday.com/2011/06/20/i-dont-like-the-ruby-1-9-hash-syntax/" target="_blank" rel="external">JSON STYLE åæ§½</a><br><a href="http://ruby-china.org/topics/2662" target="_blank" rel="external">RubyChinaç¿»è¯‘æ–‡</a></p>
<p>ï¼ˆ1.9ç‰ˆæœ¬å¼•å…¥JSON STYLEï¼‰å½“ç„¶ä¸æ˜¯å•¦ï¼Œæœ‰äº›æ—¶å€™è¿˜ä¸€å®šè¦ä½¿ç”¨ rocket styleï¼</p>
<ol>
<li><p>You must use the rocket for symbols that require quoting:</p>
<p>  æœ‰æ•ˆï¼š<code>:&#39;where.is&#39; =&gt; x</code></p>
<p>  æ— æ•ˆï¼š<code>&#39;where.is&#39;: x</code></p>
</li>
<li><p>You must use the rocket for symbols that are not valid labels:</p>
<p> æœ‰æ•ˆï¼š<code>:$set =&gt; x</code></p>
<p> æ— æ•ˆï¼š<code>$set: x</code></p>
</li>
<li><p>You must use the rocket if you use keys in your Hashes that arenâ€™t symbols:</p>
<p> æœ‰æ•ˆï¼š<code>&#39;s&#39; =&gt; x</code></p>
<p> æ— æ•ˆï¼š<code>&#39;s&#39;: x</code></p>
</li>
<li><p>å˜é‡å½“ç„¶ä¹Ÿä¸è¡Œï¼Œå¦‚ï¼š</p>
<p> def generate_token(column)<br>   begin</p>
<pre><code>self<span class="string">[column]</span> = SecureRandom.urlsafe_base64
</code></pre><p>   end while User.exists?(column =&gt; self[column])<br> end<br> è¿™é‡Œçš„ column =&gt; self[column]<br> ä¸èƒ½å†™æˆ<br> column: self[column]<br> å› ä¸ºcolumnæ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œä¸æ˜¯symbol</p>
</li>
</ol>
<p>æ€»ç»“æ¥è¯´ï¼ŒJSON style åªæ˜¯keyæ˜¯symbolçš„hashçš„ä¸€ç§ç®€æ´å†™æ³•ï¼Œä½¿ç”¨èŒƒå›´æœ‰æ•ˆï¼Œä½†ä¹Ÿè¶³å¤Ÿï¼Œå› ä¸ºhashéƒ½æå€¡keyç”¨symbolã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆæå€¡ä½¿ç”¨symbolä½œä¸ºhashçš„keyï¼Ÿ">ä¸ºä»€ä¹ˆæå€¡ä½¿ç”¨symbolä½œä¸ºhashçš„keyï¼Ÿ</h4><p><a href="http://stackoverflow.com/questions/8189416/why-use-symbols-as-hash-keys-in-ruby" target="_blank" rel="external">StackOverflow Ref</a></p>
<h3 id="å…ƒç¼–ç¨‹">å…ƒç¼–ç¨‹</h3><ol>
<li><p>æŸ¥çœ‹æŸä¸ªç±»çš„ç±»æ–¹æ³•ï¼š<code>OauthUser.methods</code></p>
</li>
<li><p>æŸ¥çœ‹æŸä¸ªç±»çš„å®ä¾‹æ–¹æ³•ï¼š <code>OauthUser.instance_methods</code></p>
</li>
<li><p>æŸ¥çœ‹æŸä¸ªç±»æœ‰æ²¡æœ‰å«æœ‰ç‰¹å®šå…³é”®å­—çš„æ–¹æ³•ï¼š <code>OauthUser.methods.grep /account/</code></p>
</li>
<li><p>ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯ <strong>Class</strong> ç±»çš„å®ä¾‹ï¼Œç±»æ–¹æ³•å®è´¨ä¸Šæ˜¯å‚¨å­˜åœ¨ <strong>eigenclass</strong> é‡Œé¢çš„å•ä»¶æ–¹æ³•</p>
</li>
<li><p><code>extend self</code>çš„ä½¿ç”¨ï¼ˆå‚è€ƒbalalaikaçš„ <strong>legacy_migrate.rb</strong> ï¼‰</p>
<p>ä¸€èˆ¬ç”¨åœ¨Moduleä¸­ï¼Œå› ä¸ºModuleæ— æ³•å®ä¾‹åŒ–ï¼Œæ‰€ä»¥æƒ³åƒè°ƒç”¨ç±»æ–¹æ³•ä¸€æ ·è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œå°±extend è‡ªå·±ï¼Œextend æœ¬è´¨ä¸Šç­‰åŒäº</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="inheritance">&lt;</span><span class="inheritance">&lt; <span class="parent">self</span></span></span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">Module</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">M</span></span></span><br><span class="line">  <span class="keyword">extend</span> <span class="keyword">self</span>      <span class="comment">##ç­‰åŒäº extend M</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">greeting</span></span></span><br><span class="line">    puts <span class="string">"hi!"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯å°±å¯ä»¥è°ƒç”¨ <code>M.greeting</code>, greetingæ—¢æ˜¯å®ä¾‹æ–¹æ³•ï¼Œä¹Ÿæ˜¯å•ä»¶æ–¹æ³•ã€‚<br>å¦‚æœåªæ˜¯å•çº¯æƒ³è°ƒç”¨ <code>M.greeting</code>çš„è¯ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å†™</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">M</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">greeting</span></span></span><br><span class="line">    puts <span class="string">"hi!"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™greetingåªæ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼ˆå•ä»¶æ–¹æ³•ï¼‰</p>
</li>
<li><p>extend vs include</p>
<p><code>extend Module</code> =&gt; ç±»æ–¹æ³•</p>
<p><code>include Module</code> =&gt; å®ä¾‹æ–¹æ³•</p>
</li>
</ol>
<h3 id="æ“ä½œç¬¦">æ“ä½œç¬¦</h3><ol>
<li><p><code>&amp;</code> ç¬¦å·</p>
<ul>
<li><p><code>&amp;</code>ç¬¦å·æ˜¯æŠŠProcè½¬æ¢æˆBlockçš„æ“ä½œç¬¦ï¼Œ</p>
<pre><code>feet_over_4 = Proc.<span class="keyword">new</span> { |<span class="variable">height</span>| <span class="variable">height</span> &gt;= <span class="number">4</span> }
some_array.collect(&amp;feet_over_4) #æ³¨æ„æ˜¯æ‹¬å·è€Œä¸æ˜¯å¤§æ‹¬å·
</code></pre></li>
<li><p><code>&amp;:symbol</code></p>
<p>  å› ä¸º<code>&amp;</code>æ˜¯æŠŠProcè½¬æ¢æˆBlockï¼Œæ‰€ä»¥<code>:symbol</code>è¦å…ˆè½¬æ¢æˆProc</p>
<pre><code>def to_proc
    <span class="keyword">proc</span> { |obj, *args| obj.send(self, *args) }
<span class="keyword">end</span>
</code></pre><p>  æ‰€ä»¥</p>
<pre><code>some_array.map{|<span class="literal">a</span>| <span class="literal">a</span>.upcase}
</code></pre><p>  ç­‰äº</p>
<pre><code>some_array.<span class="function"><span class="title">map</span><span class="params">(&amp;:upcase)</span></span>
</code></pre></li>
</ul>
</li>
</ol>
<h3 id="Block,_Proc,_Lambda">Block, Proc, Lambda</h3><h4 id="Block">Block</h4><p><code>Block</code> åªæ˜¯ä¸€äº›ä»£ç ç‰‡æ®µé›†åˆï¼Œä¸æ˜¯<code>object</code></p>
<h4 id="Proc">Proc</h4><p><code>Proc</code> æ˜¯å¯¹è±¡ï¼Œæ‹¥æœ‰å¯¹è±¡æ‰€æœ‰ç‰¹æ€§</p>
<h4 id="Lambda">Lambda</h4><p><code>Lambda</code> ä¹Ÿæ˜¯å¯¹è±¡</p>
<h4 id="Proc_vs_Lambda">Proc vs Lambda</h4><p>Another important but subtle difference is in the way procs created with lambda and procs created with Proc.new handle the return statement:</p>
<p>In a lambda-created proc, the return statement returns only from the proc itself<br>In a Proc.new-created proc, the return statement is a little more surprising: it returns control not just from the proc, but also from the method enclosing the proc!<br>Hereâ€™s lambda-created procâ€™s return in action. It behaves in a way that you probably expect:</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">whowouldwin</span></span>

    mylambda = lambda {<span class="keyword">return</span> <span class="string">"Freddy"</span>}
    mylambda.call

    <span class="comment"># mylambda gets called and returns "Freddy", and execution</span>
    <span class="comment"># continues on the next line</span>

    <span class="keyword">return</span> <span class="string">"Jason"</span>

<span class="keyword">end</span>


whowouldwin
<span class="status">=&gt;</span> <span class="string">"Jason"</span>
</code></pre><p>Now hereâ€™s a Proc.new-created procâ€™s return doing the same thing. Youâ€™re about to see one of those cases where Ruby breaks the much-vaunted Principle of Least Surprise:</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">whowouldwin2</span></span>

  myproc = <span class="constant">Proc</span>.new {<span class="keyword">return</span> <span class="string">"Freddy"</span>}
  myproc.call

  <span class="comment"># myproc gets called and returns "Freddy",</span>
  <span class="comment"># but also returns control from whowhouldwin2!</span>
  <span class="comment"># The line below *never* gets executed.</span>

  <span class="keyword">return</span> <span class="string">"Jason"</span>

<span class="keyword">end</span>


whowouldwin2
<span class="status">=&gt;</span> <span class="string">"Freddy"</span>
</code></pre><p>Thanks to this surprising behaviour (as well as less typing), I tend to favour using lambda over Proc.new when making procs.</p>
<h3 id="Module_Mixin">Module Mixin</h3><p><code>Module/Class</code>ä¸€èˆ¬åŒ…å«3ç§æ–¹æ³•ï¼Œ<code>Macro</code>, <code>ClassMethods</code>, <code>IntanceMethods</code><br><code>Macro</code>å…¶å®å°±æ˜¯æ‰§è¡Œçœç•¥æ‰selfçš„æ–¹æ³•ï¼Œå¦‚:</p>
<pre><code>has_many <span class="symbol">:tags</span>
ç­‰äº
<span class="keyword">self</span>.has_many <span class="symbol">:tags</span>
</code></pre><h4 id="ç»å…¸åšæ³•">ç»å…¸åšæ³•</h4><pre><code><span class="class"><span class="keyword">module</span> <span class="title">TagLib</span></span>

  <span class="class"><span class="keyword">module</span> <span class="title">ClassMethods</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title">find_by_tags</span><span class="params">()</span></span>
      <span class="comment"># ...</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="class"><span class="keyword">module</span> <span class="title">InstanceMethods</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title">tags</span><span class="params">()</span></span>
      <span class="comment"># ...</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">included</span><span class="params">(base)</span></span>
    base.send <span class="symbol">:include</span>, <span class="constant">InstanceMethods</span>
    base.send <span class="symbol">:extend</span>, <span class="constant">ClassMethods</span>
    base.class_eval <span class="keyword">do</span>
      <span class="comment">#è¿™é‡Œä½¿ç”¨intance_evalä¹Ÿæ˜¯åŒæ ·çš„æ•ˆæœï¼Œå› ä¸ºselféƒ½æ˜¯base</span>
      logger.warn...
    <span class="keyword">end</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="class"><span class="keyword">class</span> <span class="title">ActiveRecord::Base</span></span>
  <span class="keyword">include</span> <span class="constant">TagLib</span>
<span class="keyword">end</span>
</code></pre><h4 id="å–„ç”¨ActiveSupport::Concern">å–„ç”¨ActiveSupport::Concern</h4><h5 id="Rail3">Rail3</h5><pre><code><span class="class"><span class="keyword">module</span> <span class="title">TagLib</span></span>
  extend <span class="constant">ActiveSupport::Concern</span>

  included <span class="keyword">do</span>
    logger.warn ...
  <span class="keyword">end</span>

  <span class="class"><span class="keyword">module</span> <span class="title">ClassMethods</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title">find_by_tags</span><span class="params">()</span></span>
      <span class="comment"># ...</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="class"><span class="keyword">module</span> <span class="title">InstanceMethods</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title">tags</span><span class="params">()</span></span>
      <span class="comment"># ...</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="class"><span class="keyword">class</span> <span class="title">ActiveRecord::Base</span></span>
  <span class="keyword">include</span> <span class="constant">TagLib</span>
<span class="keyword">end</span>
</code></pre><h5 id="Rails4">Rails4</h5><p>ä¸å†éœ€è¦æŠŠå®ä¾‹æ–¹æ³•åŒ…åœ¨<code>Module InstanceMethods</code>é‡Œï¼Œç›´æ¥å†™åœ¨å¤–é¢å°±å¯ä»¥</p>
<pre><code><span class="class"><span class="keyword">module</span> <span class="title">TagLib</span></span>
  extend <span class="constant">ActiveSupport::Concern</span>

  included <span class="keyword">do</span>
    logger.warn...
  <span class="keyword">end</span>

  <span class="class"><span class="keyword">module</span> <span class="title">ClassMethods</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title">find_by_tags</span><span class="params">()</span></span>
      <span class="comment"># ...</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="function"><span class="keyword">def</span> <span class="title">tags</span><span class="params">()</span></span>
    <span class="comment"># ...</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="class"><span class="keyword">class</span> <span class="title">ActiveRecord::Base</span></span>
  <span class="keyword">include</span> <span class="constant">TagLib</span>
<span class="keyword">end</span>
</code></pre><h5 id="self-included(base)_æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ">self.included(base) æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</h5><p>è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨moduleè¢«includeçš„æ—¶å€™æ‰§è¡Œçš„ï¼Œbaseå°±æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¦‚ï¼š</p>
<pre><code><span class="class"><span class="keyword">module</span> <span class="title">B</span></span>
  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">included</span><span class="params">(base)</span></span>
    puts base
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="class"><span class="keyword">module</span> <span class="title">A</span></span>
  <span class="keyword">include</span> <span class="constant">B</span>
<span class="keyword">end</span>
<span class="status">=&gt;</span> <span class="constant">A</span>

æ‰€ä»¥ä¸Šé¢ä¾‹å­çš„

<span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">included</span><span class="params">(base)</span></span>
base.send <span class="symbol">:include</span>, <span class="constant">InstanceMethods</span>
base.send <span class="symbol">:extend</span>, <span class="constant">ClassMethods</span>
base.class_eval <span class="keyword">do</span>
    <span class="comment">#è¿™é‡Œä½¿ç”¨intance_evalä¹Ÿæ˜¯åŒæ ·çš„æ•ˆæœï¼Œå› ä¸ºselféƒ½æ˜¯base</span>
    logger.warn...
<span class="keyword">end</span>
<span class="keyword">end</span>

base å°±æ˜¯ <span class="constant">ActiveRecord::Base</span>ï¼Œ æ‰€ä»¥ intance_eval å’Œ class_eval
çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œ

å‚è€ƒä¸‹é¢çš„ <span class="string">`instance_eval`</span> vs <span class="string">`class_eval`</span>
</code></pre><h3 id="instance_eval_vs_class_eval"><code>instance_eval</code> vs <code>class_eval</code></h3><pre><code><span class="constant">Foo</span> = <span class="constant">Class</span>.new
<span class="constant">Foo</span>.instance_eval { puts <span class="keyword">self</span> }
<span class="status">=&gt;</span> <span class="constant">Foo</span>
<span class="constant">Foo</span>.class_eval { puts <span class="keyword">self</span> }
<span class="status">=&gt;</span> <span class="constant">Foo</span>

foo = <span class="constant">Foo</span>.new
foo.instance_eval { puts <span class="keyword">self</span> }
<span class="status">=&gt;</span> <span class="value">#&lt;Foo:0x007fc49aa42ea8&gt;</span>
<span class="status">=&gt;</span> å¯ç”¨äºåˆ›é€ å•ä¾‹æ–¹æ³•

foo.class_eval { puts <span class="keyword">self</span> }
<span class="status">=&gt;</span> <span class="value">#&lt;Class:#&lt;Foo:0x007fc49aa42ea8&gt;</span>&gt;
=&gt; è¿™ä¸ªåº”è¯¥æ˜¯ç­‰äº<span class="constant">Foo</span>å§ï¼Ÿè¿™æ ·å°±ç›¸å½“äºæ‰“å¼€ç±»äº†ï¼Œå¯ç”¨äºåˆ›é€ å®ä¾‹æ–¹æ³•
</code></pre></span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blog/tags/ruby/" rel="tag">#ruby</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2015/07/29/lixian-115/" rel="next">115 ç¦»çº¿ä¸‹è½½å‘½ä»¤è¡Œå·¥å…·ï¼ˆæ‰¹é‡æ·»åŠ ç§å­/ç£åŠ›é“¾ï¼‰</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


            </div>

            

            
              <div class="comments" id="comments">
                
                  <div class="ds-thread" data-thread-key="2015/09/07/learning-ruby/"
                       data-title="Ruby å­¦ä¹ è®°å½• (æ›´æ–°ä¸­)" data-url="http://liujin.me/blog/2015/09/07/learning-ruby/">
                  </div>
                
              </div>
            
        </div>

        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®éŒ„
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            æœ¬ç«™æ¦‚è¦½
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars3.githubusercontent.com/u/1059327" alt="Jin Liu" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Jin Liu</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/blog/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">æ–‡ç« </span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/blog/categories">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">åˆ†é¡</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/blog/tags">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">æ¨™ç±¤</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/blog/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/coolzilj" target="_blank">github</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/coolzilj" target="_blank">weibo</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/coolzilj" target="_blank">zhihu</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¸¸ç”¨å‘½ä»¤"><span class="nav-number">1.</span> <span class="nav-text">å¸¸ç”¨å‘½ä»¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€ä½³å®è·µ"><span class="nav-number">2.</span> <span class="nav-text">æœ€ä½³å®è·µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ–‡ç« "><span class="nav-number">3.</span> <span class="nav-text">æ–‡ç« </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rails"><span class="nav-number">4.</span> <span class="nav-text">Rails</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-_å†™routeçš„æ—¶å€™ï¼Œactionå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œviewæ‰æ˜¯å¿…é¡»çš„"><span class="nav-number">4.1.</span> <span class="nav-text">1. å†™routeçš„æ—¶å€™ï¼Œactionå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œviewæ‰æ˜¯å¿…é¡»çš„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-_Array/Hash_éƒ½ç»§æ‰¿äº†_Enumerable_çš„æ–¹æ³•ï¼Œä½†map,collect,map!,collect!_åªæœ‰Arrayæ‰æ”¯æŒ"><span class="nav-number">4.2.</span> <span class="nav-text">2. Array/Hash éƒ½ç»§æ‰¿äº† Enumerable çš„æ–¹æ³•ï¼Œä½†map,collect,map!,collect! åªæœ‰Arrayæ‰æ”¯æŒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-_Hash_to_URL_query"><span class="nav-number">4.3.</span> <span class="nav-text">3. Hash to URL query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-_rails_console_tips"><span class="nav-number">4.4.</span> <span class="nav-text">4. rails console tips</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-_érailsé¡¹ç›®ä½¿ç”¨_ActiveSupport"><span class="nav-number">4.5.</span> <span class="nav-text">5. érailsé¡¹ç›®ä½¿ç”¨ ActiveSupport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-_Rspec"><span class="nav-number">4.6.</span> <span class="nav-text">6. Rspec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-_Unicorn"><span class="nav-number">4.7.</span> <span class="nav-text">7. Unicorn</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»£ç ç‰‡æ®µ"><span class="nav-number">5.</span> <span class="nav-text">ä»£ç ç‰‡æ®µ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-_æ‰¾å‡ºnoteså­—æ®µé•¿åº¦å°äº8çš„è®°å½•"><span class="nav-number">5.1.</span> <span class="nav-text">1. æ‰¾å‡ºnoteså­—æ®µé•¿åº¦å°äº8çš„è®°å½•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-_æ£€æŸ¥æ•°ç»„æ˜¯ä¸æ˜¯å…¨éƒ¨éç©ºç™½"><span class="nav-number">5.2.</span> <span class="nav-text">2. æ£€æŸ¥æ•°ç»„æ˜¯ä¸æ˜¯å…¨éƒ¨éç©ºç™½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-_åœ¨consoleåˆ é™¤è®°å½•"><span class="nav-number">5.3.</span> <span class="nav-text">3. åœ¨consoleåˆ é™¤è®°å½•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-_use_begin-end_for_cached_value"><span class="nav-number">5.4.</span> <span class="nav-text">4. use begin..end for cached value</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ruby"><span class="nav-number">6.</span> <span class="nav-text">Ruby</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash"><span class="nav-number">6.1.</span> <span class="nav-text">Hash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#{}çœç•¥çš„æƒ…å†µ"><span class="nav-number">6.1.1.</span> <span class="nav-text">{}çœç•¥çš„æƒ…å†µ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rocket_style_æ˜¯ä¸æ˜¯å·²ç»åºŸå¼ƒæ‰äº†ï¼Ÿ"><span class="nav-number">6.1.2.</span> <span class="nav-text">rocket style æ˜¯ä¸æ˜¯å·²ç»åºŸå¼ƒæ‰äº†ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸ºä»€ä¹ˆæå€¡ä½¿ç”¨symbolä½œä¸ºhashçš„keyï¼Ÿ"><span class="nav-number">6.1.3.</span> <span class="nav-text">ä¸ºä»€ä¹ˆæå€¡ä½¿ç”¨symbolä½œä¸ºhashçš„keyï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…ƒç¼–ç¨‹"><span class="nav-number">6.2.</span> <span class="nav-text">å…ƒç¼–ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ“ä½œç¬¦"><span class="nav-number">6.3.</span> <span class="nav-text">æ“ä½œç¬¦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Block,_Proc,_Lambda"><span class="nav-number">6.4.</span> <span class="nav-text">Block, Proc, Lambda</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Block"><span class="nav-number">6.4.1.</span> <span class="nav-text">Block</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Proc"><span class="nav-number">6.4.2.</span> <span class="nav-text">Proc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lambda"><span class="nav-number">6.4.3.</span> <span class="nav-text">Lambda</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Proc_vs_Lambda"><span class="nav-number">6.4.4.</span> <span class="nav-text">Proc vs Lambda</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Module_Mixin"><span class="nav-number">6.5.</span> <span class="nav-text">Module Mixin</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç»å…¸åšæ³•"><span class="nav-number">6.5.1.</span> <span class="nav-text">ç»å…¸åšæ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å–„ç”¨ActiveSupport::Concern"><span class="nav-number">6.5.2.</span> <span class="nav-text">å–„ç”¨ActiveSupport::Concern</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Rail3"><span class="nav-number">6.5.2.1.</span> <span class="nav-text">Rail3</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Rails4"><span class="nav-number">6.5.2.2.</span> <span class="nav-text">Rails4</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#self-included(base)_æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"><span class="nav-number">6.5.2.3.</span> <span class="nav-text">self.included(base) æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#instance_eval_vs_class_eval"><span class="nav-number">6.6.</span> <span class="nav-text">instance_eval vs class_eval</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jin Liu</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="http://hexo.io">Hexo</a> å¼·åŠ›é©…å‹•
</div>

<div class="theme-info">
  ä¸»é¡Œ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



        </div>
    </footer>

    <div class="back-to-top"></div>
</div>

<script type="text/javascript" src="/blog/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"liujin-blog"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
  	  <script type="text/javascript">
  		var duoshuo_user_ID = 0
  	  </script>
     
  	<script src="/blog/js/ua-parser.min.js"></script>
  	<script src="/blog/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/blog/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/blog/js/fancy-box.js?v=0.4.4"></script>


  <script type="text/javascript" src="/blog/js/helpers.js?v=0.4.4"></script>
  

  <script type="text/javascript" src="/blog/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/blog/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/blog/js/motion_global.js?v=0.4.4" id="motion.global"></script>



  <script type="text/javascript" src="/blog/js/search-toggle.js"></script>


  
<script type="text/javascript" src="/blog/js/bootstrap.scrollspy.js?v=0.4.4" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



<script type="text/javascript">
    $(document).ready(function () {
        if (CONFIG.sidebar === 'always') {
            displaySidebar();
        }
    });
</script>








<!-- lazyload -->
<script type="text/javascript" src="/blog/js/lazyload.js"></script>
<script type="text/javascript">
    jQuery(function () {
        jQuery("#posts img").lazyload({
            placeholder: "/blog/images/loading.gif",
            effect: "fadeIn"
        });
    });
</script>
</body>
</html>
